# GitHub Actions에서 보여질 워크플로우 이름
# → 이 레포는 인프라 설정을 검증하는 목적이라는 걸 명확히 드러냄
name: Validate Infra Config

# 이 워크플로우가 언제 실행될지 정의
on:
  # main 브랜치에 push 될 때 실행
  push:
    branches: ["main"]

  # Pull Request가 생성되거나 수정될 때 실행
  pull_request:

jobs:
  validate:
    # GitHub가 제공하는 Ubuntu 환경에서 실행
    runs-on: ubuntu-latest

    steps:
      # 1. 현재 레포지토리 코드를 러너 VM으로 가져옴
      - uses: actions/checkout@v4

      # 2. docker-compose.yml 문법 및 설정 검증
      #    - YAML 문법 오류
      #    - 잘못된 키
      #    - 파싱 불가능한 구조
      #    같은 문제가 있으면 여기서 바로 실패
      - name: Validate docker-compose
        run: docker compose config

      # 3. nginx 설정 파일 문법 검증
      #    - 실제 nginx 컨테이너를 잠깐 실행해서
      #    - nginx -t 명령으로 설정 유효성 검사
      #    - 서버에 올리기 전에 "이 설정이 진짜로 동작 가능한가"를 보증
      # - name: Validate nginx config
      #   run: |
      #     docker run --rm \
      #       -v $PWD/nginx/nginx.conf:/etc/nginx/nginx.conf:ro \
      #       nginx:alpine nginx -t
